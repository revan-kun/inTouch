/*
 * Mambo jQuery Plugin
 * @author: Valerio Barrila aka NinjaTux
 * @twitter: ninjatux2k
 */;(function(d,e,f,b){var a="mambo",c={percentage:100,circleColor:"#F2AC29",circleBorder:"#FFF",ringStyle:"percentage",ringColor:"#F2762E",ringBackground:"#CCC",labelColor:"#FFF",displayValue:true,drawShadow:false},h=Math.PI/180,i=2*Math.PI;function g(k,j){this.element=k;this.options=d.extend(true,{},c,j);this._defaults=c;this._name=a;this.init()}g.prototype={init:function(){if(this.checkCanvas()){this.context=this.element.getContext("2d");this.percentage=this.options.percentage*3.6;this.points=this.getPoints();d(this.element).css({width:this.points.width+"px",height:this.points.width+"px"});this.linesAndRadiuses=this.getLinesAndRadiuses();this.drawPercentage();if(this.options.ringStyle==="full"&&this.percentage!==360){this.drawExtraPercentage()}this.drawInternalCircle();if(this.options.drawShadow){this.drawShadow()}if(this.options.image){this.drawImage()}else{this.drawText()}}},drawInternalCircle:function(){this.context.beginPath();this.context.moveTo(this.points.x,this.points.x);this.context.arc(this.points.x,this.points.x,this.linesAndRadiuses.internalRadius,0,i,false);this.context.fillStyle=this.options.circleColor;this.context.lineWidth=this.linesAndRadiuses.internalLine;this.context.closePath();this.context.strokeStyle=this.options.circleBorder;this.context.stroke();this.context.fill()},drawPercentage:function(){this.context.beginPath();this.context.moveTo(this.points.x,this.points.x);this.context.arc(this.points.x,this.points.x,this.linesAndRadiuses.externalRadius,this.points.angle.start,this.points.angle.end,false);this.context.closePath();this.context.fillStyle=this.options.ringColor;this.context.fill()},drawExtraPercentage:function(){this.context.beginPath();this.context.moveTo(this.points.x,this.points.x);this.context.arc(this.points.x,this.points.x,this.linesAndRadiuses.externalRadius,this.points.angle.start,this.points.angle.end,true);this.context.closePath();this.context.fillStyle=this.options.ringBackground;this.context.fill()},drawShadow:function(){this.context.beginPath();this.context.arc(this.points.x,this.points.x,this.linesAndRadiuses.shadowRadius,0,i,false);this.context.shadowColor="#cbcbcb";this.context.lineWidth=this.linesAndRadiuses.shadowLine;this.context.strokeStyle="rgba(255,255,255, 0.3)";this.context.stroke()},drawImage:function(){var j=(this.linesAndRadiuses.internalRadius-this.linesAndRadiuses.internalLine)*Math.sqrt(2),l=new Image(),k,n,m,o=this;l.src=this.options.image;l.onload=function(){m=l.height/l.width;if(l.width>j&&m<=1){k=j;n=Math.round(k*m)}else{if(l.height>j){n=j;k=Math.round(n/m)}else{k=n=j}}o.context.drawImage(l,(o.points.width-k)/2,(o.points.width-n)/2,k,n)}},drawText:function(){var j;this.context.textAlign="center";this.context.fillStyle=this.options.labelColor;this.context.textBaseline="bottom";if(this.options.displayValue){j=this.points.width/3.5;this.context.font="bold "+j+"px helvetica";if(this.options.label&&this.options.label.length>0){this.context.fillText(this.options.label,this.points.x,this.points.x+this.linesAndRadiuses.internalRadius/25);this.context.fillText(this.options.percentage+"%",this.points.x,this.points.x+this.linesAndRadiuses.internalRadius/1.5)}else{this.context.fillText(this.options.percentage+"%",this.points.x,this.points.x+this.linesAndRadiuses.internalRadius/2.3)}}else{j=this.points.width/2.5;this.context.font="bold "+j+"px helvetica";this.context.fillText(this.options.label,this.points.x,this.points.x+this.linesAndRadiuses.internalRadius/1.8)}},checkCanvas:function(){return !!(this.element.getContext&&this.element.getContext("2d"))},getPoints:function(){return{width:this.element.width,x:this.element.width/2,angle:{start:(this.percentage===360)?0:270*h,end:(this.percentage===360)?i:(this.percentage-90)*h}}},getLinesAndRadiuses:function(){var l=this.points.width/30,j=this.points.x-l/2,n=j,k=this.points.width/35,m=n*0.8;return{shadowLine:l,shadowRadius:j,externalRadius:n,internalLine:k,internalRadius:m}}};d.fn[a]=function(j){return this.each(function(){if(!d.data(this,"plugin_"+a)){d.data(this,"plugin_"+a,new g(this,j))}})}})(jQuery,window,document);